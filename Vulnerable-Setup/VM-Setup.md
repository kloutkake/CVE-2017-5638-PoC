# Vulnerable Environment Setup for CVE-2017-5638

## Table of Contents

- [Prerequisites](#prerequisites)
- [Installing Apache Tomcat](#installing-apache-tomcat)
- [Installing Java](#installing-java)
- [Installing Vulnerable Apache Struts](#installing-vulnerable-apache-struts)
- [Deploying a Vulnerable Web Application](#deploying-a-vulnerable-web-application)
- [Verifying the Setup](#verifying-the-setup)

---

## Prerequisites

Ensure you have the following before starting:

- A virtualization platform like **VirtualBox**, **VMware**, or **KVM**.
- A Linux distribution installed (e.g., **Ubuntu**).
- **Java Development Kit (JDK)** or **Java Runtime Environment (JRE)**.
- **Apache Tomcat** or a compatible servlet container.
- Vulnerable versions of **Apache Struts 2** (pre-2.3.32 or 2.5.10.1).

---

## Installing Apache Tomcat

Tomcat is a servlet container required to run Java web applications, like the vulnerable Apache Struts application. We install it to deploy and test the web app.
```bash
sudo apt install tomcat9
sudo systemctl start tomcat9
```
Ensure Tomcat manager is installed, it is needed to manage and deploy applications through tomcat.
- Locate /var/lib/webapps/manager
- If not there, go to [Apache Tomcat Download Page](https://tomcat.apache.org/download-90.cgi)
```bash
tar -xzf apache-tomcat-9.x.x.tar.gz
cd apache-tomcat-9.x.x/webapps
sudo cp -r apache-tomcat-9.x.x/webapps/manager /var/lib/tomcat9/webapps/
```
Make the following changes for permissions in the tomcat-users element:
```bash
sudo vim /etc/tomcat9/tomcat-users.xml
```
```xml
<role rolename="manager-gui"/>
<user username="admin" password="admin" roles="manager-gui"/>
```
Configure context.xml with the following attribute:
```bash
sudo vim /etc/tomcat9/context.xml
```
```xml
<Context privileged="true">
```

---

## Installing Java

Apache Struts requires Java to run, so you need to install **JDK** or **JRE**.
```bash
sudo apt install openjdk-11-jdk
```
Update JAVA_HOME
```bash
sudo vim /etc/environment
JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
```
Update JAVA_HOME for Tomcat
```bash
sudo vim /etc/default/tomcat9
JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
```

---

## Installing Vulnerable Apache Struts

Download a vulnerable version of Struts 2 then extract it and set it up: [Version prior to 2.3.32 or 2.5.10.1](https://archive.apache.org/dist/struts/).
```bash
sudo unzip struts-2.3.30-all.zip
```
- Locate struts-2.3.30/apps/struts2-showcase.war

---

## Deploying a Vulnerable Web Application

Deploy the struts2-showcase.war,it is a sample application provided by Apache Struts that includes a variety of features.
```bash
sudo mv struts2-showcase.war /var/lib/tomcat9/webapps/
sudo systemctl restart tomcat9
```
---

## Verifying the Setup

Before running the exploit, ensure that the vulnerable environment is set up correctly.
- http://"your-vm-ip":8080/struts2.showcase
- Use the PoC script by sending a crafted HTTP request with a malicious header.
